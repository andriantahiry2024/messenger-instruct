# Instructions

Pendant votre interaction avec l'utilisateur, si vous trouvez quelque chose de r√©utilisable dans ce projet (par exemple, version d'une biblioth√®que, nom de mod√®le), en particulier concernant une correction √† une erreur que vous avez commise ou une correction que vous avez re√ßue, vous devez le noter en cr√©ant une le√ßon dans un fichier Le√ßon.md au m√™me niveau que le fichier `.cursorrules` afin de ne pas commettre la m√™me erreur √† nouveau.

Vous devriez √©galement utiliser le fichier `.cursorrules` comme bloc-notes pour organiser vos pens√©es. Particuli√®rement lorsque vous recevez une nouvelle t√¢che, vous devriez d'abord examiner le contenu du bloc-notes, effacer les anciennes t√¢ches diff√©rentes si n√©cessaire, expliquer d'abord la t√¢che, et planifier les √©tapes que vous devez suivre pour accomplir la t√¢che. Vous pouvez utiliser des marqueurs de t√¢ches pour indiquer la progression, par exemple :
[X] T√¢che 1
[ ] T√¢che 2

Mettez √©galement √† jour la progression de la t√¢che dans le bloc-notes lorsque vous terminez une sous-t√¢che.
Particuli√®rement lorsque vous avez termin√© une √©tape importante, il sera utile d'am√©liorer votre profondeur d'accomplissement de la t√¢che en utilisant le bloc-notes pour r√©fl√©chir et planifier.
L'objectif est de vous aider √† maintenir une vue d'ensemble ainsi que la progression de la t√¢che. R√©f√©rez-vous toujours au bloc-notes lorsque vous planifiez l'√©tape suivante.

Important:
-Tu travailles g√©n√©ralement dans un environnement windows.
-Essaie toujours avant d'executer l'application le dossier courant
-Analyse bien chaques fichier avant de l'executer
-Utilise le mcp databutton pour l'execution de tes t√¢ches pour plus de performance au niveau des structurations.
-Si on te demande de cr√©er une application compl√®te agis comme un chef de projet et un d√©veloppeur s√©nior fullstack en m√™me temps. Tu cr√©era l'architecture compl√®te, les fonctionnalit√©s dans un fichier pdr que tu va cr√©er et que tu mettra au m√™me niveau que .cursorrules aussi pour que tu te rep√®re facilement.

# Outils

Notez que tous les outils sont en python. Donc, dans le cas o√π vous auriez besoin de faire du traitement par lots, vous pouvez toujours consulter les fichiers python et √©crire votre propre script.

## V√©rification par capture d'√©cran

Le flux de travail de v√©rification par capture d'√©cran vous permet de capturer des captures d'√©cran de pages web et de v√©rifier leur apparence √† l'aide de LLMs. Les outils suivants sont disponibles :

1. Capture d'√©cran :
```bash
venv/bin/python tools/screenshot_utils.py URL [--output OUTPUT] [--width WIDTH] [--height HEIGHT]
```

2. V√©rification LLM avec images :
```bash
venv/bin/python tools/llm_api.py --prompt "Votre question de v√©rification" --provider {openai|anthropic} --image path/to/screenshot.png
```

Exemple de flux de travail :
```python
from screenshot_utils import take_screenshot_sync
from llm_api import query_llm

# Prendre une capture d'√©cran

screenshot_path = take_screenshot_sync('https://example.com', 'screenshot.png')

# V√©rifier avec LLM

response = query_llm(
    "Quelle est la couleur de fond et le titre de cette page web ?",
    provider="openai",  # ou "anthropic"
    image_path=screenshot_path
)
print(response)
```

## LLM

Vous avez toujours un LLM √† vos c√¥t√©s pour vous aider dans votre t√¢che. Pour des t√¢ches simples, vous pouvez invoquer le LLM en ex√©cutant la commande suivante :
```
venv/bin/python ./tools/llm_api.py --prompt "Quelle est la capitale de la France ?" --provider "anthropic"
```

L'API LLM prend en charge plusieurs fournisseurs :
- OpenAI (par d√©faut, mod√®le : gpt-4o)
- Azure OpenAI (mod√®le : configur√© via AZURE_OPENAI_MODEL_DEPLOYMENT dans le fichier .env, par d√©faut gpt-4o-ms)
- DeepSeek (mod√®le : deepseek-chat)
- Anthropic (mod√®le : claude-3-sonnet-20240229)
- Gemini (mod√®le : gemini-pro)
- LLM local (mod√®le : Qwen/Qwen2.5-32B-Instruct-AWQ)

Mais g√©n√©ralement, c'est une meilleure id√©e de v√©rifier le contenu du fichier et d'utiliser les API dans le fichier `tools/llm_api.py` pour invoquer le LLM si n√©cessaire.

## Navigateur web

Vous pouvez utiliser le fichier `tools/web_scraper.py` pour extraire des donn√©es du web.
```
venv/bin/python ./tools/web_scraper.py --max-concurrent 3 URL1 URL2 URL3
```
Cela affichera le contenu des pages web.

## Moteur de recherche

Vous pouvez utiliser le fichier `tools/search_engine.py` pour rechercher sur le web.
```
venv/bin/python ./tools/search_engine.py "vos mots-cl√©s de recherche"
```
Cela affichera les r√©sultats de recherche dans le format suivant :
```
URL: https://example.com
Titre: Ceci est le titre du r√©sultat de recherche
Extrait: Ceci est un extrait du r√©sultat de recherche
```
Si n√©cessaire, vous pouvez ensuite utiliser le fichier `web_scraper.py` pour extraire le contenu de la page web.

# Le√ßons

## Le√ßons sp√©cifi√©es par l'utilisateur

- Si Vous avez un environnement virtuel python dans ./venv. Utilisez-le.
- Incluez des informations utiles pour le d√©bogage dans la sortie du programme.
- Lisez le fichier avant d'essayer de le modifier.
- En raison de la limite de Cursor, lorsque vous utilisez `git` et `gh` et que vous devez soumettre un message de commit multiligne, √©crivez d'abord le message dans un fichier, puis utilisez `git commit -F <nom_du_fichier>` ou une commande similaire pour valider. Puis supprimez le fichier. Incluez "[Cursor] " dans le message de commit et le titre de la PR.

## Le√ßons apprises par Cursor

- Pour les r√©sultats de recherche, assurez-vous de g√©rer correctement les diff√©rents encodages de caract√®res (UTF-8) pour les requ√™tes internationales
- Ajoutez des informations de d√©bogage √† stderr tout en gardant la sortie principale propre dans stdout pour une meilleure int√©gration de pipeline
- Lors de l'utilisation des styles seaborn dans matplotlib, utilisez 'seaborn-v0_8' au lieu de 'seaborn' comme nom de style en raison des changements r√©cents de version de seaborn
- Utilisez 'gpt-4o' comme nom de mod√®le pour les capacit√©s de vision GPT-4 d'OpenAI
- Lors de la recherche d'actualit√©s r√©centes, utilisez l'ann√©e en cours (2025) au lieu des ann√©es pr√©c√©dentes, ou utilisez simplement le mot-cl√© "r√©cent" pour obtenir les derni√®res informations
- Dans Next.js, ajoutez toujours la directive 'use client' au d√©but des fichiers qui utilisent des hooks React ou des fonctionnalit√©s sp√©cifiques au client
- Utilisez InternalAxiosRequestConfig au lieu de AxiosRequestConfig pour les intercepteurs de requ√™te Axios
- Dans Next.js, n'exportez pas de m√©tadonn√©es depuis un composant marqu√© avec "use client"
- V√©rifiez toujours le r√©pertoire courant avant d'ex√©cuter des commandes npm
- Assurez-vous que les classes Tailwind utilis√©es sont d√©finies dans la configuration
- Utilisez les classes Tailwind standard (comme border-gray-300) au lieu de classes personnalis√©es non d√©finies (comme border-gray-200)
- Dans PowerShell, utilisez le point-virgule (;) au lieu de && pour cha√Æner les commandes
- Pr√©f√©rez les classes Tailwind standard aux classes personnalis√©es m√™me si ces derni√®res sont d√©finies dans la configuration

# Bloc-notes 

## T√¢che actuelle: Cr√©ation d'une application de chat similaire √† Messenger

### Description de la t√¢che
Cr√©er une application de messagerie instantan√©e compl√®te avec des fonctionnalit√©s similaires √† Messenger, incluant une interface utilisateur moderne, des conversations en temps r√©el, et des fonctionnalit√©s de messagerie avanc√©es.

### Plan d'action
[X] 1. D√©finir les sp√©cifications et l'architecture de l'application
[X] 2. Cr√©er le document PDR (Plan de D√©veloppement et R√©alisation)
[X] 3. Configurer l'environnement de d√©veloppement
[X] 4. D√©velopper le backend
  [X] 4.1. Mettre en place la base de donn√©es avec Supabase
  [X] 4.2. Cr√©er l'API pour l'authentification
  [X] 4.3. D√©velopper les fonctionnalit√©s de messagerie en temps r√©el
  [X] 4.4. Impl√©menter la gestion des utilisateurs et des contacts
[X] 5. D√©velopper le frontend
  [X] 5.1. Cr√©er l'interface utilisateur
  [X] 5.2. Impl√©menter les composants de conversation
  [X] 5.3. D√©velopper les fonctionnalit√©s de messagerie
  [X] 5.4. Ajouter des fonctionnalit√©s suppl√©mentaires (emojis, pi√®ces jointes, etc.)
[X] 6. Int√©grer le backend et le frontend
[ ] 7. Tester l'application
  [X] 7.1. Corriger les erreurs li√©es √† la directive 'use client'
  [X] 7.2. Corriger les erreurs de type dans les services API
  [X] 7.3. Corriger les erreurs de m√©tadonn√©es dans les composants client
  [X] 7.4. Corriger les erreurs de configuration Tailwind
  [X] 7.5. Corriger les erreurs de classes Tailwind non d√©finies
  [X] 7.6. Corriger l'erreur de classe border-border
  [ ] 7.7. Tester les fonctionnalit√©s de base
[ ] 8. D√©ployer l'application

### Progression
- ‚úÖ D√©finition des sp√©cifications compl√©t√©e dans le PDR
- ‚úÖ Architecture technique d√©finie (Node.js/Express.js pour le backend, React/Next.js pour le frontend, Supabase pour la base de donn√©es)
- ‚úÖ Plan de d√©veloppement √©tabli avec estimation des d√©lais
- ‚úÖ Soumission des sp√©cifications de l'application via databutton
- ‚úÖ Configuration de l'environnement de d√©veloppement
- ‚úÖ D√©veloppement du backend avec Express.js et Supabase
- ‚úÖ Impl√©mentation des mod√®les de donn√©es (User, Conversation, Message)
- ‚úÖ Cr√©ation des API RESTful pour l'authentification, les utilisateurs, les conversations et les messages
- ‚úÖ Int√©gration de Socket.IO pour la communication en temps r√©el
- ‚úÖ Cr√©ation du sch√©ma SQL pour Supabase
- ‚úÖ Documentation de l'API dans le README.md
- ‚úÖ D√©veloppement du frontend avec React/Next.js
- ‚úÖ Impl√©mentation des composants de conversation et de message
- ‚úÖ Cr√©ation des contextes pour la gestion de l'√©tat global
- ‚úÖ Correction des erreurs li√©es √† la directive 'use client'
- ‚úÖ Correction des erreurs de type dans les services API
- ‚úÖ Correction des erreurs de m√©tadonn√©es dans les composants client
- ‚úÖ Correction des erreurs de configuration Tailwind
- ‚úÖ Correction des erreurs de classes Tailwind non d√©finies (border-gray-200 ‚Üí border-gray-300)
- ‚úÖ Correction de l'erreur de classe border-border (retour √† border-gray-200)
- üîÑ Prochaine √©tape: Tester les fonctionnalit√©s de base

### Erreurs rencontr√©es et corrections
1. **Erreur de directive 'use client'** : Les composants utilisant des hooks React comme createContext, useState, etc. n√©cessitent la directive 'use client' au d√©but du fichier dans Next.js.
   - Solution: Ajout de la directive 'use client' au d√©but des fichiers AuthContext.tsx, api.ts et socketService.ts.

2. **Erreur de type Axios** : Les types AxiosRequestConfig ne sont plus compatibles avec les intercepteurs dans les versions r√©centes d'Axios.
   - Solution: Utilisation de InternalAxiosRequestConfig au lieu de AxiosRequestConfig pour les intercepteurs.

3. **Erreur d'exportation de m√©tadonn√©es** : Next.js ne permet pas d'exporter des m√©tadonn√©es depuis un composant marqu√© avec "use client".
   - Solution: D√©placement des m√©tadonn√©es dans un fichier s√©par√© metadata.ts.

4. **Erreur de classe Tailwind** : La classe border-border n'√©tait pas d√©finie dans la configuration Tailwind.
   - Solution: Cr√©ation du fichier tailwind.config.js avec les d√©finitions de couleurs personnalis√©es et modification de globals.css pour utiliser des classes standard.

5. **Erreur de classe Tailwind non d√©finie** : La classe border-gray-200 n'√©tait pas reconnue par Tailwind.
   - Solution: Remplacement par border-gray-300 qui est une classe standard de Tailwind et d√©j√† utilis√©e ailleurs dans l'application.

6. **Erreur de classe Tailwind non d√©finie (bis)** : La classe border-gray-300 n'√©tait pas reconnue par Tailwind.
   - Solution: Ajout explicite de la palette de couleurs gray dans le fichier tailwind.config.js.

7. **Erreur de classe Tailwind border-border** : M√™me apr√®s avoir d√©fini les couleurs gray, la classe border-border n'√©tait toujours pas reconnue.
   - Solution: Retour √† l'utilisation de la classe standard border-gray-200 qui est maintenant correctement d√©finie dans la configuration.

8. **Erreur de syntaxe PowerShell** : Utilisation de && pour cha√Æner les commandes dans PowerShell, ce qui n'est pas support√©.
   - Solution: Utilisation du point-virgule (;) pour cha√Æner les commandes, par exemple cd messenger-clone/client ; npm run dev.

### D√©tails techniques
- ‚úÖ Configuration de Next.js pour le frontend
- ‚úÖ Impl√©mentation des contextes pour l'authentification et les conversations
- ‚úÖ Cr√©ation des composants r√©utilisables (MessageBubble, ConversationItem)
- ‚úÖ Mise en place des routes pour les diff√©rentes pages (accueil, chat, conversation)
- ‚úÖ Int√©gration de Tailwind CSS pour le style
- ‚úÖ Impl√©mentation des services API pour communiquer avec le backend
- ‚úÖ Int√©gration de Socket.IO pour les fonctionnalit√©s en temps r√©el 